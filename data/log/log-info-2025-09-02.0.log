25-09-02.00:26:10.630 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=1h24m6s38ms).
25-09-02.00:53:19.832 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=27m9s202ms).
25-09-02.01:36:29.924 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=43m10s92ms).
25-09-02.03:11:59.526 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=1h35m29s602ms).
25-09-02.04:28:23.508 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=1h16m23s982ms).
25-09-02.05:49:35.696 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=1h21m12s188ms).
25-09-02.07:00:55.536 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=1h11m19s839ms).
25-09-02.08:28:09.346 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=1h27m13s811ms).
25-09-02.09:29:17.341 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=1h1m7s995ms).
25-09-02.10:45:07.096 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=1h15m49s755ms).
25-09-02.10:49:46.769 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=4m39s672ms).
25-09-02.12:07:24.306 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=15m36s951ms).
25-09-02.12:23:10.014 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=15m45s708ms).
25-09-02.12:39:10.585 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=15m30s563ms).
25-09-02.12:41:30.075 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=2m19s490ms).
25-09-02.12:58:31.839 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=16m31s761ms).
25-09-02.13:14:43.946 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=15m42s94ms).
25-09-02.13:15:38.851 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=54s904ms).
25-09-02.13:34:57.329 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=17m18s454ms).
25-09-02.13:52:34.809 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=17m7s466ms).
25-09-02.14:10:24.030 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=17m19s214ms).
25-09-02.14:12:47.591 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=2m23s561ms).
25-09-02.18:56:26.730 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=13m6s957ms).
25-09-02.19:25:17.095 [SpringApplicationShutdownHook] INFO  GracefulShutdown       - Commencing graceful shutdown. Waiting for active requests to complete
25-09-02.19:25:17.099 [tomcat-shutdown ] INFO  GracefulShutdown       - Graceful shutdown complete
25-09-02.19:25:17.107 [SpringApplicationShutdownHook] INFO  HikariDataSource       - MainHikariPool - Shutdown initiated...
25-09-02.19:25:17.118 [SpringApplicationShutdownHook] INFO  HikariDataSource       - MainHikariPool - Shutdown completed.
25-09-02.19:25:42.221 [main            ] INFO  Application            - Starting Application using Java 17.0.9 with PID 67267 (/Users/didi/IdeaProjects/ai-agent-station-study/ai-agent-station-study-app/target/classes started by didi in /Users/didi/IdeaProjects/ai-agent-station-study)
25-09-02.19:25:42.222 [main            ] INFO  Application            - The following 1 profile is active: "dev"
25-09-02.19:25:42.760 [main            ] INFO  TomcatWebServer        - Tomcat initialized with port 8099 (http)
25-09-02.19:25:42.764 [main            ] INFO  Http11NioProtocol      - Initializing ProtocolHandler ["http-nio-8099"]
25-09-02.19:25:42.765 [main            ] INFO  StandardService        - Starting service [Tomcat]
25-09-02.19:25:42.765 [main            ] INFO  StandardEngine         - Starting Servlet engine: [Apache Tomcat/10.1.36]
25-09-02.19:25:42.789 [main            ] INFO  [/]                    - Initializing Spring embedded WebApplicationContext
25-09-02.19:25:42.789 [main            ] INFO  ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 553 ms
25-09-02.19:25:43.167 [main            ] INFO  PgVectorStore          - Using the vector table name: vector_store. Is empty: false
25-09-02.19:25:43.169 [main            ] INFO  PgVectorStore          - Initializing PGVectorStore schema for table: vector_store in schema: public
25-09-02.19:25:43.169 [main            ] INFO  PgVectorStore          - vectorTableValidationsEnabled false
25-09-02.19:25:43.249 [main            ] INFO  OptionalValidatorFactoryBean - Failed to set up a Bean Validation provider: jakarta.validation.NoProviderFoundException: Unable to create a Configuration, because no Jakarta Bean Validation provider could be found. Add a provider like Hibernate Validator (RI) to your classpath.
25-09-02.19:25:43.353 [main            ] INFO  Http11NioProtocol      - Starting ProtocolHandler ["http-nio-8099"]
25-09-02.19:25:43.357 [main            ] INFO  TomcatWebServer        - Tomcat started on port 8099 (http) with context path '/'
25-09-02.19:25:43.361 [main            ] INFO  Application            - Started Application in 1.33 seconds (process running for 1.596)
25-09-02.19:25:43.361 [main            ] INFO  AiAgentAutoConfiguration - AI Agent è‡ªåŠ¨è£…é…å¼€å§‹ï¼Œé…ç½®: AiAgentAutoConfigProperties(enabled=true, clientIds=[3101, 3102, 3103, 3104, 4101, 4102, 4103, 4104])
25-09-02.19:25:43.361 [main            ] INFO  AiAgentAutoConfiguration - å¼€å§‹è‡ªåŠ¨è£…é…AIå®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯IDåˆ—è¡¨: [3101, 3102, 3103, 3104, 4101, 4102, 4103, 4104]
25-09-02.19:25:43.362 [pool-2-thread-1 ] INFO  AiClientLoadDataStrategy - æŸ¥è¯¢é…ç½®æ•°æ®(ai_client_api) [3101, 3102, 3103, 3104, 4101, 4102, 4103, 4104]
25-09-02.19:25:43.362 [pool-2-thread-2 ] INFO  AiClientLoadDataStrategy - æŸ¥è¯¢é…ç½®æ•°æ®(ai_client_model) [3101, 3102, 3103, 3104, 4101, 4102, 4103, 4104]
25-09-02.19:25:43.362 [pool-2-thread-3 ] INFO  AiClientLoadDataStrategy - æŸ¥è¯¢é…ç½®æ•°æ®(ai_client_tool_mcp) [3101, 3102, 3103, 3104, 4101, 4102, 4103, 4104]
25-09-02.19:25:43.363 [pool-2-thread-4 ] INFO  AiClientLoadDataStrategy - æŸ¥è¯¢é…ç½®æ•°æ®(ai_client_system_prompt) [3101, 3102, 3103, 3104, 4101, 4102, 4103, 4104]
25-09-02.19:25:43.363 [pool-2-thread-5 ] INFO  AiClientLoadDataStrategy - æŸ¥è¯¢é…ç½®æ•°æ®(ai_client_advisor) [3101, 3102, 3103, 3104, 4101, 4102, 4103, 4104]
25-09-02.19:25:43.363 [pool-2-thread-6 ] INFO  AiClientLoadDataStrategy - æŸ¥è¯¢é…ç½®æ•°æ®(ai_client) [3101, 3102, 3103, 3104, 4101, 4102, 4103, 4104]
25-09-02.19:25:43.369 [pool-2-thread-1 ] INFO  HikariDataSource       - MainHikariPool - Starting...
25-09-02.19:25:48.506 [pool-2-thread-6 ] INFO  HikariDataSource       - MainHikariPool - Starting...
25-09-02.19:25:48.512 [main            ] ERROR AiAgentAutoConfiguration - AI Agent è‡ªåŠ¨è£…é…å¤±è´¥
java.util.concurrent.CompletionException: org.mybatis.spring.MyBatisSystemException: 
### Error querying database.  Cause: org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection
### The error may exist in file [/Users/didi/IdeaProjects/ai-agent-station-study/ai-agent-station-study-app/target/classes/mybatis/mapper/ai_client_config_mapper.xml]
### The error may involve cn.bugstack.ai.infrastructure.dao.IAiClientConfigDao.queryBySourceTypeAndId
### The error occurred while executing a query
### Cause: org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection
	at java.base/java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:315)
	at java.base/java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:320)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1770)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.mybatis.spring.MyBatisSystemException: 
### Error querying database.  Cause: org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection
### The error may exist in file [/Users/didi/IdeaProjects/ai-agent-station-study/ai-agent-station-study-app/target/classes/mybatis/mapper/ai_client_config_mapper.xml]
### The error may involve cn.bugstack.ai.infrastructure.dao.IAiClientConfigDao.queryBySourceTypeAndId
### The error occurred while executing a query
### Cause: org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:99)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:347)
	at jdk.proxy2/jdk.proxy2.$Proxy78.selectList(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.selectList(SqlSessionTemplate.java:194)
	at org.apache.ibatis.binding.MapperMethod.executeForMany(MapperMethod.java:147)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:80)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:141)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:86)
	at jdk.proxy2/jdk.proxy2.$Proxy84.queryBySourceTypeAndId(Unknown Source)
	at cn.bugstack.ai.infrastructure.adapter.repository.AgentRepository.queryAiClientApiVOListByClientIds(AgentRepository.java:72)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:359)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:138)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:727)
	at cn.bugstack.ai.infrastructure.adapter.repository.AgentRepository$$SpringCGLIB$$0.queryAiClientApiVOListByClientIds(<generated>)
	at cn.bugstack.ai.domain.agent.service.armory.business.data.impl.AiClientLoadDataStrategy.lambda$loadData$0(AiClientLoadDataStrategy.java:40)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	... 3 common frames omitted
Caused by: org.apache.ibatis.exceptions.PersistenceException: 
### Error querying database.  Cause: org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection
### The error may exist in file [/Users/didi/IdeaProjects/ai-agent-station-study/ai-agent-station-study-app/target/classes/mybatis/mapper/ai_client_config_mapper.xml]
### The error may involve cn.bugstack.ai.infrastructure.dao.IAiClientConfigDao.queryBySourceTypeAndId
### The error occurred while executing a query
### Cause: org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection
	at org.apache.ibatis.exceptions.ExceptionFactory.wrapException(ExceptionFactory.java:30)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:156)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:147)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:142)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:333)
	... 24 common frames omitted
Caused by: org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection
	at org.springframework.jdbc.datasource.DataSourceUtils.getConnection(DataSourceUtils.java:84)
	at org.mybatis.spring.transaction.SpringManagedTransaction.openConnection(SpringManagedTransaction.java:77)
	at org.mybatis.spring.transaction.SpringManagedTransaction.getConnection(SpringManagedTransaction.java:64)
	at org.apache.ibatis.executor.BaseExecutor.getConnection(BaseExecutor.java:348)
	at org.apache.ibatis.executor.SimpleExecutor.prepareStatement(SimpleExecutor.java:89)
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:64)
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:336)
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:158)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:110)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:90)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:154)
	... 31 common frames omitted
Caused by: java.sql.SQLNonTransientConnectionException: Could not create connection to database server. Attempted reconnect 3 times. Giving up.
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:110)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:97)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:89)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:63)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:73)
	at com.mysql.cj.jdbc.ConnectionImpl.connectWithRetries(ConnectionImpl.java:899)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:824)
	at com.mysql.cj.jdbc.ConnectionImpl.<init>(ConnectionImpl.java:449)
	at com.mysql.cj.jdbc.ConnectionImpl.getInstance(ConnectionImpl.java:242)
	at com.mysql.cj.jdbc.NonRegisteringDriver.connect(NonRegisteringDriver.java:198)
	at com.zaxxer.hikari.util.DriverDataSource.getConnection(DriverDataSource.java:137)
	at com.zaxxer.hikari.pool.PoolBase.newConnection(PoolBase.java:360)
	at com.zaxxer.hikari.pool.PoolBase.newPoolEntry(PoolBase.java:202)
	at com.zaxxer.hikari.pool.HikariPool.createPoolEntry(HikariPool.java:461)
	at com.zaxxer.hikari.pool.HikariPool.checkFailFast(HikariPool.java:550)
	at com.zaxxer.hikari.pool.HikariPool.<init>(HikariPool.java:98)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:111)
	at org.springframework.jdbc.datasource.DataSourceUtils.fetchConnection(DataSourceUtils.java:160)
	at org.springframework.jdbc.datasource.DataSourceUtils.doGetConnection(DataSourceUtils.java:118)
	at org.springframework.jdbc.datasource.DataSourceUtils.getConnection(DataSourceUtils.java:81)
	... 41 common frames omitted
Caused by: com.mysql.cj.exceptions.CJException: Access denied for user 'root'@'localhost' (using password: YES)
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:499)
	at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:480)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:61)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:105)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:151)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:129)
	at com.mysql.cj.protocol.a.NativeProtocol.checkErrorMessage(NativeProtocol.java:787)
	at com.mysql.cj.protocol.a.NativeProtocol.checkErrorMessage(NativeProtocol.java:709)
	at com.mysql.cj.protocol.a.NativeProtocol.checkErrorMessage(NativeProtocol.java:677)
	at com.mysql.cj.protocol.a.NativeProtocol.checkErrorMessage(NativeProtocol.java:137)
	at com.mysql.cj.protocol.a.NativeAuthenticationProvider.proceedHandshakeWithPluggableAuthentication(NativeAuthenticationProvider.java:470)
	at com.mysql.cj.protocol.a.NativeAuthenticationProvider.connect(NativeAuthenticationProvider.java:211)
	at com.mysql.cj.protocol.a.NativeProtocol.connect(NativeProtocol.java:1369)
	at com.mysql.cj.NativeSession.connect(NativeSession.java:133)
	at com.mysql.cj.jdbc.ConnectionImpl.connectWithRetries(ConnectionImpl.java:843)
	... 55 common frames omitted
25-09-02.19:25:53.576 [pool-2-thread-5 ] INFO  HikariDataSource       - MainHikariPool - Starting...
25-09-02.19:25:58.644 [pool-2-thread-2 ] INFO  HikariDataSource       - MainHikariPool - Starting...
25-09-02.19:26:03.703 [pool-2-thread-4 ] INFO  HikariDataSource       - MainHikariPool - Starting...
25-09-02.19:26:08.764 [pool-2-thread-3 ] INFO  HikariDataSource       - MainHikariPool - Starting...
25-09-02.19:28:37.066 [http-nio-8099-exec-1] INFO  [/]                    - Initializing Spring DispatcherServlet 'dispatcherServlet'
25-09-02.19:28:37.066 [http-nio-8099-exec-1] INFO  DispatcherServlet      - Initializing Servlet 'dispatcherServlet'
25-09-02.19:28:37.068 [http-nio-8099-exec-1] INFO  DispatcherServlet      - Completed initialization in 2 ms
25-09-02.19:28:37.173 [http-nio-8099-exec-2] INFO  AiAgentController      - AutoAgentæµå¼æ‰§è¡Œè¯·æ±‚å¼€å§‹ï¼Œè¯·æ±‚ä¿¡æ¯ï¼š{"aiAgentId":"4","maxStep":5,"message":"é€šè¿‡ESæŸ¥è¯¢è¢«é™æµçš„ç”¨æˆ·ï¼Œç»™å‡ºè¢«é™æµç”¨æˆ·åˆ—è¡¨ã€‚","sessionId":"session_1756812517003_n336eyz3o"}
25-09-02.19:28:37.175 [pool-2-thread-7 ] INFO  RootNode               - === åŠ¨æ€å¤šè½®æ‰§è¡Œæµ‹è¯•å¼€å§‹ ====
25-09-02.19:28:37.175 [pool-2-thread-7 ] INFO  RootNode               - ç”¨æˆ·è¾“å…¥: é€šè¿‡ESæŸ¥è¯¢è¢«é™æµçš„ç”¨æˆ·ï¼Œç»™å‡ºè¢«é™æµç”¨æˆ·åˆ—è¡¨ã€‚
25-09-02.19:28:37.175 [pool-2-thread-7 ] INFO  RootNode               - æœ€å¤§æ‰§è¡Œæ­¥æ•°: 5
25-09-02.19:28:37.175 [pool-2-thread-7 ] INFO  RootNode               - ä¼šè¯ID: session_1756812517003_n336eyz3o
25-09-02.19:28:37.176 [pool-2-thread-7 ] INFO  HikariDataSource       - MainHikariPool - Starting...
25-09-02.19:28:42.236 [pool-2-thread-7 ] ERROR AgentRepository        - Query ai agent client flow config failed, aiAgentId: 4
org.mybatis.spring.MyBatisSystemException: 
### Error querying database.  Cause: org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection
### The error may exist in file [/Users/didi/IdeaProjects/ai-agent-station-study/ai-agent-station-study-app/target/classes/mybatis/mapper/ai_agent_flow_config_mapper.xml]
### The error may involve cn.bugstack.ai.infrastructure.dao.IAiAgentFlowConfigDao.queryByAgentId
### The error occurred while executing a query
### Cause: org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:99)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:347)
	at jdk.proxy2/jdk.proxy2.$Proxy78.selectList(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.selectList(SqlSessionTemplate.java:194)
	at org.apache.ibatis.binding.MapperMethod.executeForMany(MapperMethod.java:147)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:80)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:141)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:86)
	at jdk.proxy2/jdk.proxy2.$Proxy80.queryByAgentId(Unknown Source)
	at cn.bugstack.ai.infrastructure.adapter.repository.AgentRepository.queryAiAgentClientFlowConfig(AgentRepository.java:507)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:359)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:138)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:727)
	at cn.bugstack.ai.infrastructure.adapter.repository.AgentRepository$$SpringCGLIB$$0.queryAiAgentClientFlowConfig(<generated>)
	at cn.bugstack.ai.domain.agent.service.execute.auto.step.RootNode.doApply(RootNode.java:33)
	at cn.bugstack.ai.domain.agent.service.execute.auto.step.RootNode.doApply(RootNode.java:19)
	at cn.bugstack.wrench.design.framework.tree.AbstractMultiThreadStrategyRouter.apply(AbstractMultiThreadStrategyRouter.java:31)
	at cn.bugstack.ai.domain.agent.service.execute.auto.AutoAgentExecuteStrategy.execute(AutoAgentExecuteStrategy.java:38)
	at cn.bugstack.ai.trigger.http.AiAgentController.lambda$autoAgent$0(AiAgentController.java:58)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.apache.ibatis.exceptions.PersistenceException: 
### Error querying database.  Cause: org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection
### The error may exist in file [/Users/didi/IdeaProjects/ai-agent-station-study/ai-agent-station-study-app/target/classes/mybatis/mapper/ai_agent_flow_config_mapper.xml]
### The error may involve cn.bugstack.ai.infrastructure.dao.IAiAgentFlowConfigDao.queryByAgentId
### The error occurred while executing a query
### Cause: org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection
	at org.apache.ibatis.exceptions.ExceptionFactory.wrapException(ExceptionFactory.java:30)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:156)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:147)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:142)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:333)
	... 27 common frames omitted
Caused by: org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection
	at org.springframework.jdbc.datasource.DataSourceUtils.getConnection(DataSourceUtils.java:84)
	at org.mybatis.spring.transaction.SpringManagedTransaction.openConnection(SpringManagedTransaction.java:77)
	at org.mybatis.spring.transaction.SpringManagedTransaction.getConnection(SpringManagedTransaction.java:64)
	at org.apache.ibatis.executor.BaseExecutor.getConnection(BaseExecutor.java:348)
	at org.apache.ibatis.executor.SimpleExecutor.prepareStatement(SimpleExecutor.java:89)
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:64)
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:336)
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:158)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:110)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:90)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:154)
	... 34 common frames omitted
Caused by: java.sql.SQLNonTransientConnectionException: Could not create connection to database server. Attempted reconnect 3 times. Giving up.
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:110)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:97)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:89)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:63)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:73)
	at com.mysql.cj.jdbc.ConnectionImpl.connectWithRetries(ConnectionImpl.java:899)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:824)
	at com.mysql.cj.jdbc.ConnectionImpl.<init>(ConnectionImpl.java:449)
	at com.mysql.cj.jdbc.ConnectionImpl.getInstance(ConnectionImpl.java:242)
	at com.mysql.cj.jdbc.NonRegisteringDriver.connect(NonRegisteringDriver.java:198)
	at com.zaxxer.hikari.util.DriverDataSource.getConnection(DriverDataSource.java:137)
	at com.zaxxer.hikari.pool.PoolBase.newConnection(PoolBase.java:360)
	at com.zaxxer.hikari.pool.PoolBase.newPoolEntry(PoolBase.java:202)
	at com.zaxxer.hikari.pool.HikariPool.createPoolEntry(HikariPool.java:461)
	at com.zaxxer.hikari.pool.HikariPool.checkFailFast(HikariPool.java:550)
	at com.zaxxer.hikari.pool.HikariPool.<init>(HikariPool.java:98)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:111)
	at org.springframework.jdbc.datasource.DataSourceUtils.fetchConnection(DataSourceUtils.java:160)
	at org.springframework.jdbc.datasource.DataSourceUtils.doGetConnection(DataSourceUtils.java:118)
	at org.springframework.jdbc.datasource.DataSourceUtils.getConnection(DataSourceUtils.java:81)
	... 44 common frames omitted
Caused by: com.mysql.cj.exceptions.CJException: Access denied for user 'root'@'localhost' (using password: YES)
	at jdk.internal.reflect.GeneratedConstructorAccessor53.newInstance(Unknown Source)
	at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:499)
	at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:480)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:61)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:105)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:151)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:129)
	at com.mysql.cj.protocol.a.NativeProtocol.checkErrorMessage(NativeProtocol.java:787)
	at com.mysql.cj.protocol.a.NativeProtocol.checkErrorMessage(NativeProtocol.java:709)
	at com.mysql.cj.protocol.a.NativeProtocol.checkErrorMessage(NativeProtocol.java:677)
	at com.mysql.cj.protocol.a.NativeProtocol.checkErrorMessage(NativeProtocol.java:137)
	at com.mysql.cj.protocol.a.NativeAuthenticationProvider.proceedHandshakeWithPluggableAuthentication(NativeAuthenticationProvider.java:470)
	at com.mysql.cj.protocol.a.NativeAuthenticationProvider.connect(NativeAuthenticationProvider.java:211)
	at com.mysql.cj.protocol.a.NativeProtocol.connect(NativeProtocol.java:1369)
	at com.mysql.cj.NativeSession.connect(NativeSession.java:133)
	at com.mysql.cj.jdbc.ConnectionImpl.connectWithRetries(ConnectionImpl.java:843)
	... 58 common frames omitted
25-09-02.19:28:42.237 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      - 
ğŸ¯ === æ‰§è¡Œç¬¬ 1 æ­¥ ===
25-09-02.19:28:42.239 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      - 
ğŸ“Š é˜¶æ®µ1: ä»»åŠ¡çŠ¶æ€åˆ†æ
25-09-02.19:28:42.241 [pool-2-thread-7 ] ERROR AiAgentController      - AutoAgentæ‰§è¡Œå¼‚å¸¸ï¼šCannot invoke "cn.bugstack.ai.domain.agent.model.valobj.AiAgentClientFlowConfigVO.getStepPrompt()" because "aiAgentClientFlowConfigVO" is null
java.lang.NullPointerException: Cannot invoke "cn.bugstack.ai.domain.agent.model.valobj.AiAgentClientFlowConfigVO.getStepPrompt()" because "aiAgentClientFlowConfigVO" is null
	at cn.bugstack.ai.domain.agent.service.execute.auto.step.Step1AnalyzerNode.doApply(Step1AnalyzerNode.java:32)
	at cn.bugstack.ai.domain.agent.service.execute.auto.step.Step1AnalyzerNode.doApply(Step1AnalyzerNode.java:19)
	at cn.bugstack.wrench.design.framework.tree.AbstractMultiThreadStrategyRouter.apply(AbstractMultiThreadStrategyRouter.java:31)
	at cn.bugstack.wrench.design.framework.tree.AbstractMultiThreadStrategyRouter.router(AbstractMultiThreadStrategyRouter.java:22)
	at cn.bugstack.ai.domain.agent.service.execute.auto.step.RootNode.doApply(RootNode.java:44)
	at cn.bugstack.ai.domain.agent.service.execute.auto.step.RootNode.doApply(RootNode.java:19)
	at cn.bugstack.wrench.design.framework.tree.AbstractMultiThreadStrategyRouter.apply(AbstractMultiThreadStrategyRouter.java:31)
	at cn.bugstack.ai.domain.agent.service.execute.auto.AutoAgentExecuteStrategy.execute(AutoAgentExecuteStrategy.java:38)
	at cn.bugstack.ai.trigger.http.AiAgentController.lambda$autoAgent$0(AiAgentController.java:58)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
25-09-02.19:36:17.908 [SpringApplicationShutdownHook] INFO  GracefulShutdown       - Commencing graceful shutdown. Waiting for active requests to complete
25-09-02.19:36:17.915 [tomcat-shutdown ] INFO  GracefulShutdown       - Graceful shutdown complete
25-09-02.19:36:23.555 [main            ] INFO  Application            - Starting Application using Java 17.0.9 with PID 68284 (/Users/didi/IdeaProjects/ai-agent-station-study/ai-agent-station-study-app/target/classes started by didi in /Users/didi/IdeaProjects/ai-agent-station-study)
25-09-02.19:36:23.556 [main            ] INFO  Application            - The following 1 profile is active: "dev"
25-09-02.19:36:24.122 [main            ] INFO  TomcatWebServer        - Tomcat initialized with port 8099 (http)
25-09-02.19:36:24.128 [main            ] INFO  Http11NioProtocol      - Initializing ProtocolHandler ["http-nio-8099"]
25-09-02.19:36:24.129 [main            ] INFO  StandardService        - Starting service [Tomcat]
25-09-02.19:36:24.129 [main            ] INFO  StandardEngine         - Starting Servlet engine: [Apache Tomcat/10.1.36]
25-09-02.19:36:24.152 [main            ] INFO  [/]                    - Initializing Spring embedded WebApplicationContext
25-09-02.19:36:24.152 [main            ] INFO  ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 583 ms
25-09-02.19:36:24.496 [main            ] INFO  PgVectorStore          - Using the vector table name: vector_store. Is empty: false
25-09-02.19:36:24.498 [main            ] INFO  PgVectorStore          - Initializing PGVectorStore schema for table: vector_store in schema: public
25-09-02.19:36:24.498 [main            ] INFO  PgVectorStore          - vectorTableValidationsEnabled false
25-09-02.19:36:24.581 [main            ] INFO  OptionalValidatorFactoryBean - Failed to set up a Bean Validation provider: jakarta.validation.NoProviderFoundException: Unable to create a Configuration, because no Jakarta Bean Validation provider could be found. Add a provider like Hibernate Validator (RI) to your classpath.
25-09-02.19:36:24.694 [main            ] INFO  Http11NioProtocol      - Starting ProtocolHandler ["http-nio-8099"]
25-09-02.19:36:24.702 [main            ] INFO  TomcatWebServer        - Tomcat started on port 8099 (http) with context path '/'
25-09-02.19:36:24.707 [main            ] INFO  Application            - Started Application in 1.328 seconds (process running for 1.57)
25-09-02.19:36:24.708 [main            ] INFO  AiAgentAutoConfiguration - AI Agent è‡ªåŠ¨è£…é…å¼€å§‹ï¼Œé…ç½®: AiAgentAutoConfigProperties(enabled=true, clientIds=[3101, 3102, 3103, 3104, 4101, 4102, 4103, 4104])
25-09-02.19:36:24.708 [main            ] INFO  AiAgentAutoConfiguration - å¼€å§‹è‡ªåŠ¨è£…é…AIå®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯IDåˆ—è¡¨: [3101, 3102, 3103, 3104, 4101, 4102, 4103, 4104]
25-09-02.19:36:24.710 [pool-2-thread-1 ] INFO  AiClientLoadDataStrategy - æŸ¥è¯¢é…ç½®æ•°æ®(ai_client_api) [3101, 3102, 3103, 3104, 4101, 4102, 4103, 4104]
25-09-02.19:36:24.710 [pool-2-thread-2 ] INFO  AiClientLoadDataStrategy - æŸ¥è¯¢é…ç½®æ•°æ®(ai_client_model) [3101, 3102, 3103, 3104, 4101, 4102, 4103, 4104]
25-09-02.19:36:24.710 [pool-2-thread-3 ] INFO  AiClientLoadDataStrategy - æŸ¥è¯¢é…ç½®æ•°æ®(ai_client_tool_mcp) [3101, 3102, 3103, 3104, 4101, 4102, 4103, 4104]
25-09-02.19:36:24.710 [pool-2-thread-4 ] INFO  AiClientLoadDataStrategy - æŸ¥è¯¢é…ç½®æ•°æ®(ai_client_system_prompt) [3101, 3102, 3103, 3104, 4101, 4102, 4103, 4104]
25-09-02.19:36:24.711 [pool-2-thread-5 ] INFO  AiClientLoadDataStrategy - æŸ¥è¯¢é…ç½®æ•°æ®(ai_client_advisor) [3101, 3102, 3103, 3104, 4101, 4102, 4103, 4104]
25-09-02.19:36:24.711 [pool-2-thread-6 ] INFO  AiClientLoadDataStrategy - æŸ¥è¯¢é…ç½®æ•°æ®(ai_client) [3101, 3102, 3103, 3104, 4101, 4102, 4103, 4104]
25-09-02.19:36:24.719 [pool-2-thread-5 ] INFO  HikariDataSource       - MainHikariPool - Starting...
25-09-02.19:36:24.792 [pool-2-thread-5 ] INFO  HikariPool             - MainHikariPool - Added connection com.mysql.cj.jdbc.ConnectionImpl@3aa4625c
25-09-02.19:36:24.793 [pool-2-thread-5 ] INFO  HikariDataSource       - MainHikariPool - Start completed.
25-09-02.19:36:24.880 [main            ] INFO  RootNode               - Ai Agent æ„å»ºï¼Œæ•°æ®åŠ è½½èŠ‚ç‚¹{"commandIdList":["3101","3102","3103","3104","4101","4102","4103","4104"],"commandType":"client","loadDataStrategy":"aiClientLoadDataStrategy"}
25-09-02.19:36:24.880 [main            ] INFO  AiClientApiNode        - Ai Agent æ„å»ºèŠ‚ç‚¹ï¼ŒAPI æ¥å£è¯·æ±‚{"commandIdList":["3101","3102","3103","3104","4101","4102","4103","4104"],"commandType":"client","loadDataStrategy":"aiClientLoadDataStrategy"}
25-09-02.19:36:24.881 [main            ] INFO  AbstractArmorySupport  - æˆåŠŸæ³¨å†ŒBean: ai_client_api_1001
25-09-02.19:36:24.881 [main            ] INFO  AiClientToolMcpNode    - Ai Agent æ„å»ºèŠ‚ç‚¹ï¼ŒTool MCP å·¥å…·é…ç½®{"commandIdList":["3101","3102","3103","3104","4101","4102","4103","4104"],"commandType":"client","loadDataStrategy":"aiClientLoadDataStrategy"}
25-09-02.19:36:25.318 [HttpClient-10-Worker-0] INFO  McpAsyncClient         - Server response with Protocol: 2024-11-05, Capabilities: ServerCapabilities[completions=null, experimental={}, logging=null, prompts=PromptCapabilities[listChanged=false], resources=ResourceCapabilities[subscribe=false, listChanged=false], tools=ToolCapabilities[listChanged=false]], Info: Implementation[name=AIsearch, version=1.4.1] and Instructions null
25-09-02.19:36:25.387 [main            ] INFO  AiClientToolMcpNode    - Tool SSE MCP Initialized InitializeResult[protocolVersion=2024-11-05, capabilities=ServerCapabilities[completions=null, experimental={}, logging=null, prompts=PromptCapabilities[listChanged=false], resources=ResourceCapabilities[subscribe=false, listChanged=false], tools=ToolCapabilities[listChanged=false]], serverInfo=Implementation[name=AIsearch, version=1.4.1], instructions=null]
25-09-02.19:36:25.388 [main            ] INFO  AbstractArmorySupport  - æˆåŠŸæ³¨å†ŒBean: ai_client_tool_mcp_5006
25-09-02.19:36:43.805 [pool-4-thread-1 ] INFO  McpAsyncClient         - Server response with Protocol: 2024-11-05, Capabilities: ServerCapabilities[completions=null, experimental=null, logging=null, prompts=null, resources=null, tools=ToolCapabilities[listChanged=null]], Info: Implementation[name=mcp-server-elasticsearch, version=1.0.0] and Instructions null
25-09-02.19:36:43.808 [main            ] INFO  AiClientToolMcpNode    - Tool Stdio MCP Initialized InitializeResult[protocolVersion=2024-11-05, capabilities=ServerCapabilities[completions=null, experimental=null, logging=null, prompts=null, resources=null, tools=ToolCapabilities[listChanged=null]], serverInfo=Implementation[name=mcp-server-elasticsearch, version=1.0.0], instructions=null]
25-09-02.19:36:43.809 [main            ] INFO  AbstractArmorySupport  - æˆåŠŸæ³¨å†ŒBean: ai_client_tool_mcp_5007
25-09-02.19:36:43.809 [main            ] INFO  AiClientModelNode      - Ai Agent æ„å»ºèŠ‚ç‚¹ï¼ŒMode å¯¹è¯æ¨¡å‹{"commandIdList":["3101","3102","3103","3104","4101","4102","4103","4104"],"commandType":"client","loadDataStrategy":"aiClientLoadDataStrategy"}
25-09-02.19:36:43.903 [main            ] INFO  AbstractArmorySupport  - æˆåŠŸæ³¨å†ŒBean: ai_client_model_2002
25-09-02.19:36:43.903 [main            ] INFO  AbstractArmorySupport  - æˆåŠŸæ³¨å†ŒBean: ai_client_model_2001
25-09-02.19:36:43.906 [main            ] INFO  AbstractArmorySupport  - æˆåŠŸæ³¨å†ŒBean: ai_client_model_2003
25-09-02.19:36:43.906 [main            ] INFO  AiClientAdvisorNode    - Ai Agent æ„å»ºèŠ‚ç‚¹ï¼ŒAdvisor é¡¾é—®è§’è‰²{"commandIdList":["3101","3102","3103","3104","4101","4102","4103","4104"],"commandType":"client","loadDataStrategy":"aiClientLoadDataStrategy"}
25-09-02.19:36:43.909 [main            ] INFO  AbstractArmorySupport  - æˆåŠŸæ³¨å†ŒBean: ai_client_advisor_4001
25-09-02.19:36:43.910 [main            ] INFO  AiClientNode           - Ai Agent æ„å»ºèŠ‚ç‚¹ï¼Œå®¢æˆ·ç«¯{"commandIdList":["3101","3102","3103","3104","4101","4102","4103","4104"],"commandType":"client","loadDataStrategy":"aiClientLoadDataStrategy"}
25-09-02.19:36:43.979 [main            ] INFO  AbstractArmorySupport  - æˆåŠŸæ³¨å†ŒBean: ai_client_3101
25-09-02.19:36:44.103 [main            ] INFO  AbstractArmorySupport  - æˆåŠŸæ³¨å†ŒBean: ai_client_3102
25-09-02.19:36:44.168 [main            ] INFO  AbstractArmorySupport  - æˆåŠŸæ³¨å†ŒBean: ai_client_3103
25-09-02.19:36:44.168 [main            ] INFO  AbstractArmorySupport  - æˆåŠŸæ³¨å†ŒBean: ai_client_3104
25-09-02.19:36:44.172 [main            ] INFO  AbstractArmorySupport  - æˆåŠŸæ³¨å†ŒBean: ai_client_4101
25-09-02.19:36:44.174 [main            ] INFO  AbstractArmorySupport  - æˆåŠŸæ³¨å†ŒBean: ai_client_4102
25-09-02.19:36:44.176 [main            ] INFO  AbstractArmorySupport  - æˆåŠŸæ³¨å†ŒBean: ai_client_4103
25-09-02.19:36:44.176 [main            ] INFO  AbstractArmorySupport  - æˆåŠŸæ³¨å†ŒBean: ai_client_4104
25-09-02.19:36:44.177 [main            ] INFO  AiAgentAutoConfiguration - AI Agent è‡ªåŠ¨è£…é…å®Œæˆ
25-09-02.19:36:51.305 [http-nio-8099-exec-1] INFO  [/]                    - Initializing Spring DispatcherServlet 'dispatcherServlet'
25-09-02.19:36:51.305 [http-nio-8099-exec-1] INFO  DispatcherServlet      - Initializing Servlet 'dispatcherServlet'
25-09-02.19:36:51.310 [http-nio-8099-exec-1] INFO  DispatcherServlet      - Completed initialization in 5 ms
25-09-02.19:36:51.341 [http-nio-8099-exec-1] INFO  AiAgentController      - AutoAgentæµå¼æ‰§è¡Œè¯·æ±‚å¼€å§‹ï¼Œè¯·æ±‚ä¿¡æ¯ï¼š{"aiAgentId":"4","maxStep":5,"message":"é€šè¿‡ESæŸ¥è¯¢è¢«é™æµçš„ç”¨æˆ·ï¼Œç»™å‡ºè¢«é™æµç”¨æˆ·åˆ—è¡¨ã€‚","sessionId":"session_1756813011268_9hkph2uig"}
25-09-02.19:36:51.343 [pool-2-thread-7 ] INFO  RootNode               - === åŠ¨æ€å¤šè½®æ‰§è¡Œæµ‹è¯•å¼€å§‹ ====
25-09-02.19:36:51.343 [pool-2-thread-7 ] INFO  RootNode               - ç”¨æˆ·è¾“å…¥: é€šè¿‡ESæŸ¥è¯¢è¢«é™æµçš„ç”¨æˆ·ï¼Œç»™å‡ºè¢«é™æµç”¨æˆ·åˆ—è¡¨ã€‚
25-09-02.19:36:51.343 [pool-2-thread-7 ] INFO  RootNode               - æœ€å¤§æ‰§è¡Œæ­¥æ•°: 5
25-09-02.19:36:51.343 [pool-2-thread-7 ] INFO  RootNode               - ä¼šè¯ID: session_1756813011268_9hkph2uig
25-09-02.19:36:51.349 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      - 
ğŸ¯ === æ‰§è¡Œç¬¬ 1 æ­¥ ===
25-09-02.19:36:51.350 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      - 
ğŸ“Š é˜¶æ®µ1: ä»»åŠ¡çŠ¶æ€åˆ†æ
25-09-02.19:38:15.936 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      - 
ğŸ“Š === ç¬¬ 1 æ­¥åˆ†æç»“æœ ===
25-09-02.19:38:15.938 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      - 
ğŸ¯ ä»»åŠ¡çŠ¶æ€åˆ†æ:
25-09-02.19:38:15.938 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ“‹ å·²å®Œæˆï¼š
25-09-02.19:38:15.938 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ“‹ - list_indices() è°ƒç”¨æˆåŠŸå¹¶å®šä½åˆ°å€™é€‰æ—¥å¿—ç´¢å¼• group-buy-market-log-2025.09.02ã€‚
25-09-02.19:38:15.938 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ“‹ - get_mappings() æˆåŠŸï¼Œç¡®è®¤ç´¢å¼•åŒ…å« messageã€user_idã€ip_addressã€limit_reasonã€limit_typeã€@timestamp ç­‰å­—æ®µï¼Œæ»¡è¶³é™æµæ—¥å¿—æŠ½å–éœ€æ±‚ã€‚
25-09-02.19:38:15.938 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ“‹ å¾…å®Œæˆï¼š
25-09-02.19:38:15.938 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ“‹ - æ„å»ºå¹¶æ‰§è¡Œæœç´¢æŸ¥è¯¢ä»¥è¯†åˆ«è¢«é™æµçš„ç”¨æˆ·å¹¶ç”Ÿæˆç”¨æˆ·åˆ—è¡¨ï¼ˆä¸‹ä¸€æ­¥ï¼‰ã€‚
25-09-02.19:38:15.938 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ“‹ - è§£æ search ç»“æœå¹¶èšåˆæˆæœ€ç»ˆæ¸…å•ï¼ˆåŒ…å«æœ€è¿‘é™æµæ—¶é—´ã€æ¬¡æ•°ã€é™æµåŸå› ç­‰ï¼‰ã€‚
25-09-02.19:38:15.959 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      - 
ğŸ“ˆ æ‰§è¡Œå†å²è¯„ä¼°:
25-09-02.19:38:15.959 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ“Š - list_indices() ä¸ get_mappings() è°ƒç”¨æˆåŠŸï¼Œè¿”å›çš„æ•°æ®è´¨é‡è‰¯å¥½ï¼ŒæˆåŠŸç‡ 100%ï¼ˆä¸¤æ¬¡å·¥å…·è°ƒç”¨å‡æˆåŠŸï¼‰ã€‚
25-09-02.19:38:15.959 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ“Š - ç›®å‰å°šæœªè°ƒç”¨ searchï¼Œå› æ­¤å°šæœªè¯„ä¼°æœç´¢æˆåŠŸç‡ä¸è¿”å›ç»“æœè´¨é‡ã€‚
25-09-02.19:38:15.960 [pool-2-thread-7 ] ERROR AbstractExecuteSupport - å‘é€SSEç»“æœå¤±è´¥ï¼šServletOutputStream failed to flush: java.io.IOException: Broken pipe
org.springframework.web.context.request.async.AsyncRequestNotUsableException: ServletOutputStream failed to flush: java.io.IOException: Broken pipe
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleHttpServletResponse.handleIOException(StandardServletAsyncWebRequest.java:346)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:418)
	at org.springframework.util.StreamUtils.copy(StreamUtils.java:136)
	at org.springframework.http.converter.StringHttpMessageConverter.writeInternal(StringHttpMessageConverter.java:128)
	at org.springframework.http.converter.StringHttpMessageConverter.writeInternal(StringHttpMessageConverter.java:44)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:310)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.send(ResponseBodyEmitterReturnValueHandler.java:290)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:193)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:177)
	at cn.bugstack.ai.domain.agent.service.execute.auto.step.AbstractExecuteSupport.sendSseResult(AbstractExecuteSupport.java:64)
	at cn.bugstack.ai.domain.agent.service.execute.auto.step.Step1AnalyzerNode.sendAnalysisSubResult(Step1AnalyzerNode.java:166)
	at cn.bugstack.ai.domain.agent.service.execute.auto.step.Step1AnalyzerNode.parseAnalysisResult(Step1AnalyzerNode.java:105)
	at cn.bugstack.ai.domain.agent.service.execute.auto.step.Step1AnalyzerNode.doApply(Step1AnalyzerNode.java:50)
	at cn.bugstack.ai.domain.agent.service.execute.auto.step.Step1AnalyzerNode.doApply(Step1AnalyzerNode.java:19)
	at cn.bugstack.wrench.design.framework.tree.AbstractMultiThreadStrategyRouter.apply(AbstractMultiThreadStrategyRouter.java:31)
	at cn.bugstack.wrench.design.framework.tree.AbstractMultiThreadStrategyRouter.router(AbstractMultiThreadStrategyRouter.java:22)
	at cn.bugstack.ai.domain.agent.service.execute.auto.step.RootNode.doApply(RootNode.java:44)
	at cn.bugstack.ai.domain.agent.service.execute.auto.step.RootNode.doApply(RootNode.java:19)
	at cn.bugstack.wrench.design.framework.tree.AbstractMultiThreadStrategyRouter.apply(AbstractMultiThreadStrategyRouter.java:31)
	at cn.bugstack.ai.domain.agent.service.execute.auto.AutoAgentExecuteStrategy.execute(AutoAgentExecuteStrategy.java:38)
	at cn.bugstack.ai.trigger.http.AiAgentController.lambda$autoAgent$0(AiAgentController.java:58)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.apache.catalina.connector.ClientAbortException: java.io.IOException: Broken pipe
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:308)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:270)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:133)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:415)
	... 23 common frames omitted
Caused by: java.io.IOException: Broken pipe
	at java.base/sun.nio.ch.FileDispatcherImpl.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:62)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:132)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:97)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:53)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:532)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:122)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1380)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:764)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:728)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:712)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1274)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:304)
	... 26 common frames omitted
25-09-02.19:38:15.962 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      - 
ğŸš€ ä¸‹ä¸€æ­¥ç­–ç•¥:
25-09-02.19:38:15.962 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ - éœ€è¦è°ƒç”¨çš„å·¥å…·åˆ—è¡¨ï¼ˆä¸¥æ ¼é¡ºåºï¼‰ï¼š
25-09-02.19:38:15.962 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ 1. functions.JavaSDKMCPClient_searchï¼ˆå¯¹ index: "group-buy-market-log-2025.09.02" æ‰§è¡ŒæŸ¥è¯¢ï¼‰
25-09-02.19:38:15.962 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ - å·¥å…·è°ƒç”¨çš„æ­£ç¡®æ ¼å¼ï¼ˆç‰¹åˆ«æ˜¯ search çš„ queryBodyï¼‰ï¼šå¿…é¡»æ˜¯å®Œæ•´ JSON å¯¹è±¡ã€‚å»ºè®®ä½¿ç”¨ä¸‹åˆ— queryBodyï¼ˆç¤ºä¾‹ï¼‰æ¥æ£€ç´¢é™æµç›¸å…³æ—¥å¿—å¹¶èšåˆ user_idï¼š
25-09-02.19:38:15.962 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ ç¤ºä¾‹ queryBodyï¼ˆJSONï¼Œæ³¨æ„æ‰€æœ‰å­—ç¬¦ä¸²ä½¿ç”¨åŒå¼•å·ï¼‰ï¼š
25-09-02.19:38:15.962 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ {
25-09-02.19:38:15.962 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "size": 0,
25-09-02.19:38:15.962 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "sort": [
25-09-02.19:38:15.962 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ {
25-09-02.19:38:15.962 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "@timestamp": {
25-09-02.19:38:15.962 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "order": "desc"
25-09-02.19:38:15.962 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ }
25-09-02.19:38:15.962 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ }
25-09-02.19:38:15.962 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ ],
25-09-02.19:38:15.962 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "query": {
25-09-02.19:38:15.962 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "bool": {
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "should": [
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ { "match": { "message": "é™æµ" } },
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ { "match": { "message": "rate limit" } },
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ { "match": { "message": "è¢«å°ç¦" } },
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ { "match": { "message": "è®¿é—®é¢‘ç‡è¿‡é«˜" } },
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ { "match": { "limit_reason": "é™æµ" } },
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ { "match": { "limit_type": "rate limit" } }
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ ],
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "minimum_should_match": 1,
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "filter": [
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ {
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "range": {
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "@timestamp": {
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "gte": "now-30d/d",
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "lte": "now"
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ }
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ }
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ },
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ {
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "terms": {
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "level.keyword": ["ERROR", "WARN"]
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ }
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ }
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ ]
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ }
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ },
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "aggs": {
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "by_user": {
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "terms": {
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "field": "user_id.keyword",
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "size": 1000
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ },
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "aggs": {
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "last_hit": {
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "top_hits": {
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "size": 1,
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "_source": {
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "includes": ["@timestamp", "user_id", "ip_address", "limit_type", "limit_reason", "request_count", "message"]
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ },
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "sort": [
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ {
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "@timestamp": {
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "order": "desc"
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ }
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ }
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ ]
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ }
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ },
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "limit_count": {
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "value_count": {
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "field": "message"
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ }
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ }
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ }
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ },
25-09-02.19:38:15.963 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "by_ip_fallback": {
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "terms": {
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "field": "ip_address.keyword",
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "size": 1000
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ },
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "aggs": {
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "last_hit": {
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "top_hits": {
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "size": 1,
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "_source": {
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "includes": ["@timestamp", "ip_address", "limit_type", "limit_reason", "message"]
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ },
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "sort": [
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ {
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "@timestamp": {
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "order": "desc"
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ }
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ }
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ ]
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ }
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ },
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "limit_count": {
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "value_count": {
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ "field": "message"
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ }
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ }
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ }
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ }
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ }
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ }
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ è¯´æ˜ä¸å˜ä½“å»ºè®®ï¼š
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ - size: 0 é‡‡ç”¨èšåˆæ–¹å¼è·å–è¢«é™æµçš„ç”¨æˆ·åˆ—è¡¨ï¼ˆæ›´é«˜æ•ˆï¼‰ï¼Œé€šè¿‡ top_hits è·å–æ¯ä¸ªç”¨æˆ·æœ€è¿‘ä¸€æ¡é™æµè®°å½•ã€‚
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ - æ—¶é—´èŒƒå›´ filterï¼ˆç¤ºä¾‹ä¸ºè¿‡å» 30 å¤©ï¼‰å¯æ ¹æ®éœ€æ±‚è°ƒæ•´ï¼ˆå¦‚ now-7dã€now-90d ç­‰ï¼‰ã€‚
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ - è‹¥ user_id å­˜åœ¨å¤§é‡å€¼ï¼Œå¯æé«˜ terms èšåˆçš„ size æˆ–è½¬ä¸º composite aggregation åˆ†é¡µæ‹‰å–ã€‚
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ - è‹¥æ—¥å¿—ä¸­ user_id å¯èƒ½ç¼ºå¤±ï¼Œä½¿ç”¨ by_ip_fallback èšåˆä½œä¸ºé™çº§æ–¹æ¡ˆï¼ˆåŸºäº ip_addressï¼‰ã€‚
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ - é¢„æœŸçš„ç»“æœç±»å‹ï¼š
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ - èšåˆ bucketsï¼šæ¯ä¸ª user_idï¼ˆæˆ–è€… ip_addressï¼‰å¯¹åº”çš„æ¡¶ï¼ŒåŒ…å«ï¼š
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ - æœ€è¿‘ä¸€æ¬¡é™æµè®°å½•çš„ @timestampã€limit_typeã€limit_reasonã€ip_addressã€message ç­‰ã€‚
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ - limit_countï¼ˆè¯¥ç”¨æˆ·åœ¨æŸ¥è¯¢æ—¶é—´èŒƒå›´å†…è¢«åŒ¹é…åˆ°çš„é™æµæ—¥å¿—æ¬¡æ•°ï¼‰ã€‚
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ - å¯ä»¥è¿›ä¸€æ­¥å¯¼å‡ºä¸º CSV/JSONï¼Œç”Ÿæˆè¢«é™æµç”¨æˆ·æ¸…å•ã€‚
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ - æ•°æ®å¤„ç†æ–¹å¼ï¼š
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ 1. è¯»å– aggs.by_user.bucketsï¼Œæå– key (user_id)ã€limit_countã€last_hit.hits.hits[0]._source ä¸­çš„ä¿¡æ¯ã€‚
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ 2. å¯¹æ—  user_id çš„è®°å½•åˆ™è¯»å– aggs.by_ip_fallback.buckets ä½œä¸ºè¡¥å……ã€‚
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ 3. å»é‡ä¸æ’åºï¼ˆä¾‹å¦‚æŒ‰æœ€è¿‘é™æµæ—¶é—´é™åºæˆ–æŒ‰é™æµæ¬¡æ•°é™åºï¼‰ã€‚
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ 4. è¾“å‡ºå­—æ®µå»ºè®®ï¼šuser_id / ip_address, recent_limit_time, limit_type, limit_reason, limit_count, sample_message, source_indexã€‚
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ - é”™è¯¯é¢„é˜²ä¸æ ¡éªŒï¼š
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ - ä¸¥æ ¼ä¿è¯ä¼ ç»™ search çš„ queryBody ä¸ºå®Œæ•´ JSONï¼ˆä¸èƒ½ä¸º null/undefined/{}ï¼‰ã€‚
25-09-02.19:38:15.964 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ - åœ¨æ„é€  terms èšåˆæ—¶ä½¿ç”¨ .keyword å­—æ®µä»¥ä¿è¯èšåˆå‡†ç¡®æ€§ï¼ˆmapping å·²åŒ…å« keywordï¼‰ã€‚
25-09-02.19:38:15.965 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ - è‹¥è¿”å› bucket æ•°é‡è¾¾åˆ°èšåˆä¸Šé™ï¼ˆsizeï¼‰ï¼Œåº”æ”¹ä¸º composite èšåˆä»¥åˆ†é¡µé‡‡é›†å…¨éƒ¨ç”¨æˆ·ã€‚
25-09-02.19:38:15.965 [pool-2-thread-7 ] INFO  Step1AnalyzerNode      -    ğŸ¯ - è‹¥éœ€è¦æ›´ç²¾ç¡®çš„åŒ¹é…ï¼Œå¯æŠŠ should çš„ match æ¢æˆ multi_match æˆ– match_phraseï¼Œæˆ–å¢åŠ æ­£åˆ™/regexpï¼ˆè°¨æ…ä½¿ç”¨æ€§èƒ½ä»£ä»·è¾ƒé«˜çš„æŸ¥è¯¢ï¼‰ã€‚
25-09-02.19:38:15.965 [pool-2-thread-7 ] ERROR AiAgentController      - AutoAgentæ‰§è¡Œå¼‚å¸¸ï¼šResponseBodyEmitter has already completed
java.lang.IllegalStateException: ResponseBodyEmitter has already completed
	at org.springframework.util.Assert.state(Assert.java:101)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:189)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:177)
	at cn.bugstack.ai.domain.agent.service.execute.auto.step.AbstractExecuteSupport.sendSseResult(AbstractExecuteSupport.java:64)
	at cn.bugstack.ai.domain.agent.service.execute.auto.step.Step1AnalyzerNode.sendAnalysisSubResult(Step1AnalyzerNode.java:166)
	at cn.bugstack.ai.domain.agent.service.execute.auto.step.Step1AnalyzerNode.parseAnalysisResult(Step1AnalyzerNode.java:112)
	at cn.bugstack.ai.domain.agent.service.execute.auto.step.Step1AnalyzerNode.doApply(Step1AnalyzerNode.java:50)
	at cn.bugstack.ai.domain.agent.service.execute.auto.step.Step1AnalyzerNode.doApply(Step1AnalyzerNode.java:19)
	at cn.bugstack.wrench.design.framework.tree.AbstractMultiThreadStrategyRouter.apply(AbstractMultiThreadStrategyRouter.java:31)
	at cn.bugstack.wrench.design.framework.tree.AbstractMultiThreadStrategyRouter.router(AbstractMultiThreadStrategyRouter.java:22)
	at cn.bugstack.ai.domain.agent.service.execute.auto.step.RootNode.doApply(RootNode.java:44)
	at cn.bugstack.ai.domain.agent.service.execute.auto.step.RootNode.doApply(RootNode.java:19)
	at cn.bugstack.wrench.design.framework.tree.AbstractMultiThreadStrategyRouter.apply(AbstractMultiThreadStrategyRouter.java:31)
	at cn.bugstack.ai.domain.agent.service.execute.auto.AutoAgentExecuteStrategy.execute(AutoAgentExecuteStrategy.java:38)
	at cn.bugstack.ai.trigger.http.AiAgentController.lambda$autoAgent$0(AiAgentController.java:58)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
25-09-02.19:38:15.965 [pool-2-thread-7 ] ERROR AiAgentController      - å‘é€å¼‚å¸¸ä¿¡æ¯å¤±è´¥ï¼šResponseBodyEmitter has already completed
java.lang.IllegalStateException: ResponseBodyEmitter has already completed
	at org.springframework.util.Assert.state(Assert.java:101)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:189)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:177)
	at cn.bugstack.ai.trigger.http.AiAgentController.lambda$autoAgent$0(AiAgentController.java:62)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
25-09-02.19:45:53.017 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=6m28s91ms).
25-09-02.19:47:44.180 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=1m18s844ms).
25-09-02.20:54:01.914 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=1h6m17s734ms).
25-09-02.22:31:31.813 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=1h37m29s900ms).
25-09-02.23:28:43.713 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=57m11s899ms).
25-09-02.23:53:24.698 [MainHikariPool housekeeper] WARN  HikariPool             - MainHikariPool - Thread starvation or clock leap detected (housekeeper delta=24m40s986ms).
